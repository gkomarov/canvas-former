import React from 'react';

import CanvasElement from './CanvasElement';
import CreateBlock from './CreateBlock';

class LetterCanvas extends React.Component {
    constructor(props) {
        super(props);
        this.state = {
            canvasWidth: props.canvasWidth || 209,
            canvasHeight: props.canvasHeight || 297,
            selectedElementId: null,
            selectedElementCoordinates: {
                x: null,
                y: null,
                width: null,
                height: null,
            },
            overSpaceCursor: {
                x: null,
                y: null,
            },
            elements: {}
        }
        this.changePosition = this.changePosition.bind(this);
        this.changeSize = this.changeSize.bind(this);
        this.addNewElement = this.addNewElement.bind(this);
        this.editElement = this.editElement.bind(this);
        this.submitCanvas = this.submitCanvas.bind(this);
        this.selectElement = this.selectElement.bind(this);
        this.removeElement = this.removeElement.bind(this);
        this.removeSelection = this.removeSelection.bind(this);
        this.loadTemplate = this.loadTemplate.bind(this);
        this.resetTemplate = this.resetTemplate.bind(this);
        this.fixResize = this.fixResize.bind(this);
    }

    checkOnBorder (target, pageCoord, movementCoord, limiter) {
        const newCoord = this.state.selectedElementCoordinates[target] + movementCoord;
        const overSpaceCursor = this.state.overSpaceCursor;
        if ((newCoord <= 0 || newCoord >= limiter) && !overSpaceCursor[target]) {
            this.setState({ overSpaceCursor: {
                ...this.state.overSpaceCursor,
                [target]: pageCoord,
            }})
        }
        return newCoord;
    }

    
    loadTemplate () {
        let response = '{"blockSize":{"y":842,"x":595},"elements":{"el0":{"X":0,"Y":0,"Width":595,"Height":58,"Type":"Text","Content":"Header","ContentRef":null,"id":"el0"},"el1":{"X":305,"Y":67,"Width":290,"Height":437,"Type":"Text","Content":"Right Block","ContentRef":null,"id":"el1"},"el2":{"X":0,"Y":68,"Width":285,"Height":436,"Type":"Text","Content":"Left Block","ContentRef":null,"id":"el2"}';
        response += ',"el3":{"X":0,"Y":514,"Width":595,"Height":100,"Type":"Graphics","Content": null,"ContentRef": "data:image/jpeg;base64,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SSSSSSSSSSSLbbaCP/8A/wD/AP8A/wD/AP8A/wCJJJJJJJJJJJJlttFI/wD/AP8A/wD/AP8A/wD/AP4kkyEkkkkkkkkW22Ej/wD/AP8A/wD/AP8A/wD/APiSRaCSSSSSSSSBBCSP/wD/AP8A/wD/AP8A/wD/AOJMFohJJJEhJJJJJJI//wD/AP8A/wD/AP8A/wD/AImi20Qkmi2iUkkkkkj/AP8A/wD/AP8A/wD/AP8A/iZbbbASJbbbISSSSSP/AP8A/wD/AP8A/wD/AP8A+MttttgBttttsBJJJI//AP8A/wD/AP8A/wD/AP8A6C22222222222iEkkj//AP8A/wD/AP8A/wD/AP8ApbbbbbbbbbbbbaKSSP8A/wD/AP8A/wD/AP8A/wD/ALbbbbbbbbbbbbbYCSP/AP8A/wD/AP8A/wD/AP8A/tttttttttttttttAI//AP8A/wD/AP8A/wD/AP8A+2222222222222220T//AP8A/wD/AP8A/wD/AP8A7bbbbbbbbbbbbbbbbf8A/wD/AP8A/wD/AP8A/wD/ALbbbbbbbbbbbbbbbbf/AP8A/wD/AP8A/wD/AP8A/ttttttttttttttttt//AP8A/wD/AP8A/wD/AP8A+22222222222222223//AP8A/wD/AP8A/wD/AP8A7bbbbbbbbbbbbbbbbf8A/wD/AP8A/wD/AP8A/wD/ALbbbbbbbbbbbbbbbbf/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wC//wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/2gAIAQEDAT8Q/mceILtwwXgMnaqlopaKWilopaKWilopaKWilopaKWilopaKWilopaKWilopaKWilopaKWilopaKWilopaKWilopaKWgSO/eQL7iOZOjRbIexWyNotkPYrZG0WyHsVsjaLZD2K2RtFsh7FbI2i2QtQJ7o5DMp6uXa+gUH6H2ivydfQp7nmozHJbI2i2QtIXYvwH6jojyxJ5AQrgzWk8J+8bZG0WyFoJABJwF5RzuZuGg5jZDh4LHhbI2i2QtBiBo77Lug+UA+ruFsjaLZC0PoTj9EdBwoP8Au/hbI2i2QtAiFgDj8rECJ3MUbmv8IAAADAXDhbI2i2Q8x0FcF+hBaTGoxGFzqDULDkAJIADycAqJg042yNotkPKC6gP1Ekkk3k4lAp3AneXB8DFenwv1ZEGBdNXznlkgY3nZXiPK/OS2RtFsh5D7CCJsY4DQacQU94xGoQ58w0PQFu8IfqvdAjALgFgg+P6ENEAHMda2RtFsh4kgB5wRnH6EeUMwvsCDj3HblAEjgMSUQvuhn6okkvN5OJ4v861GRTh8tkgQQ8YdS2RtFsh4575/nO768vkQKd5cQd5+QMUTvOyBhznLz9TBOAEx34enbI2i2Q8BOoBpFEkl5vJx6F87yqBBom8HvggB98c/VECR5OJPSco8M4jwUIvxFj0bZG0WyFF2EMtToi7GO3SzNffo6oJBeC4jAhOYMBinaQc9sjaDAKbgLx+KNdQH61Psi1CCXAcdOHyEAEBBwI5bZG0baS2lnutRkV9sWXJbI2jbN6ugF+tgrkfFfnC2RtG27CnF8viPlHC+xFiL7Rtu9JDbd6SG270kNt3pIbbvSQ23ekgfUKAQxDiDn4VEKiFRCohUQqIVEKiFRCohUQqIVEKiFRCohUQqIVEKiFRCohUQqIVEKiFRCohUQqIVEKiFRCu2+CAALz9f27//2gAIAQIDAT8Q/wAfj//aAAgBAwMBPxD+aHJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJyd/g4f//Z","id":"el3"}';
        response += ',"el4":{"X":0,"Y":634,"Width":595,"Height":77,"Type":"Text","Content": "Footer","ContentRef": null,"id":"el4"}';
        response += ',"el5":{"X":35,"Y":723,"Width":126,"Height":119,"Type":"Graphics","Content": null,"ContentRef":"data:image/jpeg;base64,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SSSSSSSSSSSLbbaCP/8A/wD/AP8A/wD/AP8A/wCJJJJJJJJJJJJlttFI/wD/AP8A/wD/AP8A/wD/AP4kkyEkkkkkkkkW22Ej/wD/AP8A/wD/AP8A/wD/APiSRaCSSSSSSSSBBCSP/wD/AP8A/wD/AP8A/wD/AOJMFohJJJEhJJJJJJI//wD/AP8A/wD/AP8A/wD/AImi20Qkmi2iUkkkkkj/AP8A/wD/AP8A/wD/AP8A/iZbbbASJbbbISSSSSP/AP8A/wD/AP8A/wD/AP8A+MttttgBttttsBJJJI//AP8A/wD/AP8A/wD/AP8A6C22222222222iEkkj//AP8A/wD/AP8A/wD/AP8ApbbbbbbbbbbbbaKSSP8A/wD/AP8A/wD/AP8A/wD/ALbbbbbbbbbbbbbYCSP/AP8A/wD/AP8A/wD/AP8A/tttttttttttttttAI//AP8A/wD/AP8A/wD/AP8A+2222222222222220T//AP8A/wD/AP8A/wD/AP8A7bbbbbbbbbbbbbbbbf8A/wD/AP8A/wD/AP8A/wD/ALbbbbbbbbbbbbbbbbf/AP8A/wD/AP8A/wD/AP8A/ttttttttttttttttt//AP8A/wD/AP8A/wD/AP8A+22222222222222223//AP8A/wD/AP8A/wD/AP8A7bbbbbbbbbbbbbbbbf8A/wD/AP8A/wD/AP8A/wD/ALbbbbbbbbbbbbbbbbf/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wC//wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/2gAIAQEDAT8Q/mceILtwwXgMnaqlopaKWilopaKWilopaKWilopaKWilopaKWilopaKWilopaKWilopaKWilopaKWilopaKWilopaKWgSO/eQL7iOZOjRbIexWyNotkPYrZG0WyHsVsjaLZD2K2RtFsh7FbI2i2QtQJ7o5DMp6uXa+gUH6H2ivydfQp7nmozHJbI2i2QtIXYvwH6jojyxJ5AQrgzWk8J+8bZG0WyFoJABJwF5RzuZuGg5jZDh4LHhbI2i2QtBiBo77Lug+UA+ruFsjaLZC0PoTj9EdBwoP8Au/hbI2i2QtAiFgDj8rECJ3MUbmv8IAAADAXDhbI2i2Q8x0FcF+hBaTGoxGFzqDULDkAJIADycAqJg042yNotkPKC6gP1Ekkk3k4lAp3AneXB8DFenwv1ZEGBdNXznlkgY3nZXiPK/OS2RtFsh5D7CCJsY4DQacQU94xGoQ58w0PQFu8IfqvdAjALgFgg+P6ENEAHMda2RtFsh4kgB5wRnH6EeUMwvsCDj3HblAEjgMSUQvuhn6okkvN5OJ4v861GRTh8tkgQQ8YdS2RtFsh4575/nO768vkQKd5cQd5+QMUTvOyBhznLz9TBOAEx34enbI2i2Q8BOoBpFEkl5vJx6F87yqBBom8HvggB98c/VECR5OJPSco8M4jwUIvxFj0bZG0WyFF2EMtToi7GO3SzNffo6oJBeC4jAhOYMBinaQc9sjaDAKbgLx+KNdQH61Psi1CCXAcdOHyEAEBBwI5bZG0baS2lnutRkV9sWXJbI2jbN6ugF+tgrkfFfnC2RtG27CnF8viPlHC+xFiL7Rtu9JDbd6SG270kNt3pIbbvSQ23ekgfUKAQxDiDn4VEKiFRCohUQqIVEKiFRCohUQqIVEKiFRCohUQqIVEKiFRCohUQqIVEKiFRCohUQqIVEKiFRCu2+CAALz9f27//2gAIAQIDAT8Q/wAfj//aAAgBAwMBPxD+aHJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJyd/g4f//Z","id":"el5"}';
        response += ',"el6":{"X":227,"Y":725,"Width":130,"Height":117,"Type":"Graphics","Content": null,"ContentRef": "data:image/jpeg;base64,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SSSSSSSSSSSLbbaCP/8A/wD/AP8A/wD/AP8A/wCJJJJJJJJJJJJlttFI/wD/AP8A/wD/AP8A/wD/AP4kkyEkkkkkkkkW22Ej/wD/AP8A/wD/AP8A/wD/APiSRaCSSSSSSSSBBCSP/wD/AP8A/wD/AP8A/wD/AOJMFohJJJEhJJJJJJI//wD/AP8A/wD/AP8A/wD/AImi20Qkmi2iUkkkkkj/AP8A/wD/AP8A/wD/AP8A/iZbbbASJbbbISSSSSP/AP8A/wD/AP8A/wD/AP8A+MttttgBttttsBJJJI//AP8A/wD/AP8A/wD/AP8A6C22222222222iEkkj//AP8A/wD/AP8A/wD/AP8ApbbbbbbbbbbbbaKSSP8A/wD/AP8A/wD/AP8A/wD/ALbbbbbbbbbbbbbYCSP/AP8A/wD/AP8A/wD/AP8A/tttttttttttttttAI//AP8A/wD/AP8A/wD/AP8A+2222222222222220T//AP8A/wD/AP8A/wD/AP8A7bbbbbbbbbbbbbbbbf8A/wD/AP8A/wD/AP8A/wD/ALbbbbbbbbbbbbbbbbf/AP8A/wD/AP8A/wD/AP8A/ttttttttttttttttt//AP8A/wD/AP8A/wD/AP8A+22222222222222223//AP8A/wD/AP8A/wD/AP8A7bbbbbbbbbbbbbbbbf8A/wD/AP8A/wD/AP8A/wD/ALbbbbbbbbbbbbbbbbf/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wC//wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/2gAIAQEDAT8Q/mceILtwwXgMnaqlopaKWilopaKWilopaKWilopaKWilopaKWilopaKWilopaKWilopaKWilopaKWilopaKWilopaKWgSO/eQL7iOZOjRbIexWyNotkPYrZG0WyHsVsjaLZD2K2RtFsh7FbI2i2QtQJ7o5DMp6uXa+gUH6H2ivydfQp7nmozHJbI2i2QtIXYvwH6jojyxJ5AQrgzWk8J+8bZG0WyFoJABJwF5RzuZuGg5jZDh4LHhbI2i2QtBiBo77Lug+UA+ruFsjaLZC0PoTj9EdBwoP8Au/hbI2i2QtAiFgDj8rECJ3MUbmv8IAAADAXDhbI2i2Q8x0FcF+hBaTGoxGFzqDULDkAJIADycAqJg042yNotkPKC6gP1Ekkk3k4lAp3AneXB8DFenwv1ZEGBdNXznlkgY3nZXiPK/OS2RtFsh5D7CCJsY4DQacQU94xGoQ58w0PQFu8IfqvdAjALgFgg+P6ENEAHMda2RtFsh4kgB5wRnH6EeUMwvsCDj3HblAEjgMSUQvuhn6okkvN5OJ4v861GRTh8tkgQQ8YdS2RtFsh4575/nO768vkQKd5cQd5+QMUTvOyBhznLz9TBOAEx34enbI2i2Q8BOoBpFEkl5vJx6F87yqBBom8HvggB98c/VECR5OJPSco8M4jwUIvxFj0bZG0WyFF2EMtToi7GO3SzNffo6oJBeC4jAhOYMBinaQc9sjaDAKbgLx+KNdQH61Psi1CCXAcdOHyEAEBBwI5bZG0baS2lnutRkV9sWXJbI2jbN6ugF+tgrkfFfnC2RtG27CnF8viPlHC+xFiL7Rtu9JDbd6SG270kNt3pIbbvSQ23ekgfUKAQxDiDn4VEKiFRCohUQqIVEKiFRCohUQqIVEKiFRCohUQqIVEKiFRCohUQqIVEKiFRCohUQqIVEKiFRCu2+CAALz9f27//2gAIAQIDAT8Q/wAfj//aAAgBAwMBPxD+aHJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJyd/g4f//Z","id":"el6"}';
        response += ',"el7":{"X":412,"Y":722,"Width":126,"Height":120,"Type":"Graphics","Content": null,"ContentRef": "data:image/jpeg;base64,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SSSSSSSSSSSLbbaCP/8A/wD/AP8A/wD/AP8A/wCJJJJJJJJJJJJlttFI/wD/AP8A/wD/AP8A/wD/AP4kkyEkkkkkkkkW22Ej/wD/AP8A/wD/AP8A/wD/APiSRaCSSSSSSSSBBCSP/wD/AP8A/wD/AP8A/wD/AOJMFohJJJEhJJJJJJI//wD/AP8A/wD/AP8A/wD/AImi20Qkmi2iUkkkkkj/AP8A/wD/AP8A/wD/AP8A/iZbbbASJbbbISSSSSP/AP8A/wD/AP8A/wD/AP8A+MttttgBttttsBJJJI//AP8A/wD/AP8A/wD/AP8A6C22222222222iEkkj//AP8A/wD/AP8A/wD/AP8ApbbbbbbbbbbbbaKSSP8A/wD/AP8A/wD/AP8A/wD/ALbbbbbbbbbbbbbYCSP/AP8A/wD/AP8A/wD/AP8A/tttttttttttttttAI//AP8A/wD/AP8A/wD/AP8A+2222222222222220T//AP8A/wD/AP8A/wD/AP8A7bbbbbbbbbbbbbbbbf8A/wD/AP8A/wD/AP8A/wD/ALbbbbbbbbbbbbbbbbf/AP8A/wD/AP8A/wD/AP8A/ttttttttttttttttt//AP8A/wD/AP8A/wD/AP8A+22222222222222223//AP8A/wD/AP8A/wD/AP8A7bbbbbbbbbbbbbbbbf8A/wD/AP8A/wD/AP8A/wD/ALbbbbbbbbbbbbbbbbf/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wC//wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/AP8A/wD/2gAIAQEDAT8Q/mceILtwwXgMnaqlopaKWilopaKWilopaKWilopaKWilopaKWilopaKWilopaKWilopaKWilopaKWilopaKWilopaKWgSO/eQL7iOZOjRbIexWyNotkPYrZG0WyHsVsjaLZD2K2RtFsh7FbI2i2QtQJ7o5DMp6uXa+gUH6H2ivydfQp7nmozHJbI2i2QtIXYvwH6jojyxJ5AQrgzWk8J+8bZG0WyFoJABJwF5RzuZuGg5jZDh4LHhbI2i2QtBiBo77Lug+UA+ruFsjaLZC0PoTj9EdBwoP8Au/hbI2i2QtAiFgDj8rECJ3MUbmv8IAAADAXDhbI2i2Q8x0FcF+hBaTGoxGFzqDULDkAJIADycAqJg042yNotkPKC6gP1Ekkk3k4lAp3AneXB8DFenwv1ZEGBdNXznlkgY3nZXiPK/OS2RtFsh5D7CCJsY4DQacQU94xGoQ58w0PQFu8IfqvdAjALgFgg+P6ENEAHMda2RtFsh4kgB5wRnH6EeUMwvsCDj3HblAEjgMSUQvuhn6okkvN5OJ4v861GRTh8tkgQQ8YdS2RtFsh4575/nO768vkQKd5cQd5+QMUTvOyBhznLz9TBOAEx34enbI2i2Q8BOoBpFEkl5vJx6F87yqBBom8HvggB98c/VECR5OJPSco8M4jwUIvxFj0bZG0WyFF2EMtToi7GO3SzNffo6oJBeC4jAhOYMBinaQc9sjaDAKbgLx+KNdQH61Psi1CCXAcdOHyEAEBBwI5bZG0baS2lnutRkV9sWXJbI2jbN6ugF+tgrkfFfnC2RtG27CnF8viPlHC+xFiL7Rtu9JDbd6SG270kNt3pIbbvSQ23ekgfUKAQxDiDn4VEKiFRCohUQqIVEKiFRCohUQqIVEKiFRCohUQqIVEKiFRCohUQqIVEKiFRCohUQqIVEKiFRCu2+CAALz9f27//2gAIAQIDAT8Q/wAfj//aAAgBAwMBPxD+aHJycnJycnJycnJycnJycnJycnJycnJycnJycnJycnJyd/g4f//Z","id":"el7"}';
        response += '}}';
        const template = JSON.parse(response);
        this.setState({ canvasWidth: template.blockSize.x, canvasHeight: template.blockSize.y, elements: template.elements });
    }

    resetTemplate () {
        this.setState({ elements: {}});
    }
        
    changePosition (data) {
        this.setState({ elements: {
                ...this.state.elements,
                [data.id]: {
                    ...this.state.elements[data.id],
                    X: data.x,
                    Y: data.y,
                    Width: data.width,
                    Height: data.height,
                }
            },
        })
    }

    changeSize (data) {
        this.setState({ elements: {
                ...this.state.elements,
                [data.id]: {
                    ...this.state.elements[data.id],
                    Width: data.offsetWidth,
                    Height: data.offsetHeight,
                }
            },
        })
    }

    removeElement (id) {
        let elements = {};
        Object.assign(elements, this.state.elements);
        delete elements[id];
        this.setState({ selectedElementId: null, elements });
    }

    submitCanvas () {
        const state = this.state;
        const blockSize = {y: state.canvasHeight, x: state.canvasWidth};
        const elements = [];
        for (let key in state.elements) {
            let element = state.elements[key];
            elements.push(element);
        }
        const coords = {
            blockSize,
            elements
        }
        console.info(coords);
        console.info(JSON.stringify(coords));
    }

    selectElement (event) {
        const selectedElementId = event.target.parentElement.id;
        if (selectedElementId) {
            this.setState({ selectedElementId });
        }
    }

    addNewElement (element) {
        const elementKey = Object.keys(this.state.elements).length;
        this.setState({ elements: {
                ...this.state.elements,
                [`el${elementKey}`] : element
            }
        })
    }

    editElement (element) {
        this.setState({ elements: {
            ...this.state.elements,
            [element.id] : {
                ...this.state.elements[element.id],
                Content: element.Content,
                ContentRef: element.ContentRef,
            }
        },
        selectedElementId: null,
        })
    }

    fixResize (dir, refToElement, position) {
        // library fix on resize
        if (dir === 'left' || dir === 'top' || dir === 'topRight' || dir === 'topLeft' || dir === 'bottomLeft') {
            const id = refToElement.id;
            this.setState({ elements: {
                ...this.state.elements,
                [id]: {
                    ...this.state.elements[id],
                    X: position.x,
                    Y: position.y
                }
            }})
        }
    }
    
    renderCanvasElements (elements) {
        let canvasElements = []
        const containerSize = {
            Width: this.state.canvasWidth,
            Height: this.state.canvasHeight,
        }
        for (let id in elements) {
            let element = elements[id];
            canvasElements.push((
                <CanvasElement
                    key = {`e${id}`}
                    selectedElementId = {this.state.selectedElementId}
                    elementId = {id}
                    width = {element.Width}
                    height = {element.Height}
                    x = {element.X}
                    y = {element.Y}
                    content = {element.Content}
                    contentRef = {element.ContentRef}
                    checkPosition={this.checkPosition}
                    containerSize={containerSize}
                    onChangePosition = {this.changePosition}
                    onSelect = {this.selectElement}
                    onChangeSize = {this.changeSize}
                    onRemove = {this.removeElement}
                    onResize = {this.fixResize}
                />
            ))
        }
        return canvasElements;
    }

    removeSelection (event) {
        if (event.target.childElementCount > 0) {
            this.setState({ selectedElementId: null });
        }
    }
  

    render (){
        const elements = this.state.elements;
        let selectedElement = elements[this.state.selectedElementId];
        if (selectedElement) selectedElement.id = this.state.selectedElementId;
        return (
            <div className="container">
                <div className="row justify-content-md-center">
                    <div className="col-md-5">
                        <CreateBlock 
                            submitCanvas={this.submitCanvas} 
                            addNewElement={this.addNewElement}
                            editElement={this.editElement} 
                            onLoadTemplate={this.loadTemplate} 
                            onResetTemplate={this.resetTemplate}
                            selectedElement={selectedElement} 
                            clearSelected={() => this.setState({ selectedElementId: null })} 
                        />
                    </div>
                    
                    <div className="col-md-7">
                        <div className="position-relative card" >    
                            <div style={{ height: this.state.canvasHeight, width: this.state.canvasWidth }} onClick={this.removeSelection} className="limiter position-relative">
                                {this.renderCanvasElements(elements)}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        )
    }
}

export default LetterCanvas;